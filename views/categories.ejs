<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/variables.css">
  <link rel="stylesheet" href="/nav.css">
  <link rel="stylesheet" href="/categories.css">
  <link rel="stylesheet" href="/search.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
  <title>Inventory App Categories</title>
</head>
<body class="panel playfair-display-400">
  <%- include("partials/nav.ejs", {currentPage: 'categories'}); %>
  <main>
    <section>
      <header>
        <div>
          <a href="/categories/edit" title="Manage category type"><img src="/images/pen.svg" alt="manage category types"></a>
          
          <h2>Categories by type</h2> 
        </div>
        <p class="sub-header">
          <span class="item-count">total # of categories: <%= categories.length %>, </span>
          <span class="item-count">total item count: <%= item_count %></span>
        </p>
      </header>
      <section class="mid-section">
        <ul>
          
          <% let currType = ""; %>
          <% for (let i = 0; i < categories.length; i++) { %>
            <% if (categories[i].type != currType) {  %>
              <% currType = categories[i].type; %>
              
              <li>
                <header>
                  
                  <a href="/categories/edit/<%= categories[i].category_id %>" title="Manage categories"><img src="/images/pen.svg" alt="manage categories"></a>
                  <span>Category Type:</span> <%= categories[i].type %>
                </header>
                <ul class="wrapper">
                  <li class="box">
                    <a href="/categories/edit/<%= categories[i].category_id %>">
                      <span>Manage category</span>
                      <span class="large-count"><img class="large-icon" src="/images/wonky-plus-mod.svg" alt="Add icon"></span>
                    </a>
                  </li>
                  
                  <% while( (i < categories.length) && (currType === categories[i].type)) { %>
                    
                    <li class="box" name="<%= categories[i].category_id %>">
                      <a href="/search/category/<%= categories[i].category_id %>">
                        <span class="box-title"><%= categories[i].category_name %></span>
                        <span>Qty: <span class="large-count"><%= categories[i].pcountbycatid %></span></span>
                      </a>
                    </li>
                    <% i++; %>
                    <% } %>
                    <% i--; %>
                  </ul>
                  
                  <span>Item count for this type:  <span><%= categories[i].pcountbycattype %></span></span>
                </li>
                <% } } %>
              </ul>
            </section>
          </section>
        </main>
      </body>
      </html>
      
      <!-- sample
      {
      category_id: 1,
      type: 'gender',
      category_name: 'unisex',
      pcountbycatid: '14',
      pcountbycattype: '168'
      },
      {
      category_id: 4,
      type: 'haute',
      category_name: 'couture',
      pcountbycatid: '1',
      pcountbycattype: '1'
      }
      ]
      -->